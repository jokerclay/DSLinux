# 查找

ASL: 平均查找长度

# 顺序查找

* 从头到脚

* 查找判定树


# 折半查找(二分查找)

* 仅适用于 有序序列


查找目标 33

low           mid            high
|              |              |
V              V              V
7 10 13 16 19 29 32 33 37 41 43

33 > 29 -> 右边

                low    mid   high
                 |      |     |
                 V      V     V
7 10 13 16 19 29 32 33 37 41 43

33 < 37 -> 左边

                mid
                 |
                 V
                low high
                 |  |
                 v  v
7 10 13 16 19 29 32 33 37 41 43

33 > 32 -> 右边
                   mid
                    |
                    V
                   low
                    |
                    V
                   high
                    |
                    v
7 10 13 16 19 29 32 33 37 41 43

33 == 33 找到元素 33


# 分块查找

```
    |           |        |        |
7 10|13 19 16 20|27 22 30|40 36 43|50 48
=<10|  =<20     | =<30   |  =<40  | =<50
                 ||
                 ||建立索引表(保存最大的[关键字]和[存储区间])
                 VV
     10    20    30     40      50
    [0,1] [2,5] [6,8] [9,10] [11,13]

```

给序列分块, 建立分块的索引表
块内无序，块间有序

1. 索引表中确定元素所属分块(可顺序查找分块，可折半查找 分块)

2. 分块内部顺序查找

* 若 查找表 是 动态查找表,可以采用链式存储

```
     10 -> 20 -> 30 ->  40 ->   50
    [0,1] [2,5] [6,8] [9,10] [11,13]
      7     13   27     40     43
      |     |    |      |      |
      V     V    V      V      V
     10    19    22    36     50
            |    |             |
            V    V             V
           16   30            48
            |
            V
           20

```

# 二叉排序树

查找长度: 对比关键字的次数
查找成功的平均查找长度
查找失败的平均查找长度

# 平衡二叉树

AVL 树

平衡二叉树: 树上任一结点的左子树和右子树的高度之差不超过 1

结点的平衡因子 = 左子树高 - 右子树高

* 平衡二叉树的插入
    * 从插入点往回找到第一个不平衡结点，调整以该结点为根的子树
    * 每次调整的都是 “最小不平衡子树”
    * 在插入操作中，只要将最小不平衡子树调整平衡，其他祖先节点都会恢复平衡

* 调整最小不平衡子树
(调整目的: 1.恢复平衡。2.保持二叉排序树特性。)
(Bl < B < Br < A < Ar)
```
    * LL
        * A 的 【左孩子的左子树】 中插入，导致不平衡
                                                         
         A                                  B            
       /   \       B 右上旋               /   \          
      B     Ar    ------------------->   Bl    A         
     /  \          B 代替 A 成为根节点        /  \       
   Bl    Br        A 成为 B 的右子树        Br    Ar     
                                                         
                                                         
    * RR
        * A 的 【右孩子的右子树】 中插入，导致不平衡
                                                        
         A                                     B        
       /   \        B 左上旋                 /   \      
      Al    B     ------------------->      A     Br    
           /  \     B 代替 A 成为根节点    / \          
         Bl    Br   A 成为 B 的右子树    Al  Bl         
                                                        
                                                        



    * LR
        * A 的 【左孩子的右子树】 中插入，导致不平衡
                                                                                                      
         A                                     A                                        C             
       /   \    C 左上旋 代替 B               / \     C 再 右上旋  代替 A            /    \           
      B     Ar ------------------------>     C   Ar  ------------------------>      B      A          
    /  \                                   /  \                                    / \    /  \        
   Bl   C                                 B   Cr                                 Bl  Cl  Cr   Ar      
      /  \                               / \                                                          
     Cl   Cr                            Bl Cl                                                         
                                                                                                      

    * RL
        * A 的 【右孩子的左子树】 中插入，导致不平衡
                                                                                                       
        A                                   A                                           C              
      /   \     C 右上旋 代替 B            / \        C 再 左上旋  代替 A             /    \           
     Al    B   ------------------------> Ar   C   Ar  ------------------------>      A      B          
         /  \                                / \                                    / \    /  \        
       C     Br                            Cl   B                                 Ar  Cl  Cr   Br      
     /  \                                      / \                                                     
    Cl   Cr                                  Cr  Br                                                    
                                                                                                       

```

* 只有左孩子可以进行右旋操作
* 只有右孩子可以进行左旋操作

* 平衡二叉树的效率分析
不会超过 O(h)
平均查找长度，时间复杂度 O(log_{2}^{n})


# 平衡二叉树 的删除操作

* 具体步骤

    1. 删除结点(方法同二叉排序树)

    2. 一路向北找到最小不平衡子树, 找不到就完结撒花 <-----+
                                                          |
    3. 找最小不平衡子树下 "个头" 最高的 儿子 孙子         |
                                                          |
    4. 根据孙子的位置，调整平衡（LL，RR，LR，RL）         |
                                                          |
        * 孙子在 LL: 儿子右单旋                           |
        * 孙子在 RR: 儿子左单旋                           |
        * 孙子在 LR: 孙子先左旋，再右旋                   |
        * 孙子在 LL: 孙子先右旋，再左旋                   |
                                                          |
    5. 如果不平衡向上传导                                 |
                                                          |
        * 继续 2------------------------------------------+


# 红黑树

* 二叉排序树(BST:1960)， 平衡二叉树(AVL:1962)，红黑树(RBT:1972)，都是用于查找的东西

.                BST           AVL                  AVL            
生日            1960          1962                 1972            
                                                                   
                                                                   
时间    Search  O(n)     O(log_{2}^{n})       O(log_{2}^{n})       
复杂度   查                                                        
                                                                   
.       Insert  O(n)     O(log_{2}^{n})       O(log_{2}^{n})       
.        插入                                                      
                                                                   
.       Delete  O(n)     O(log_{2}^{n})       O(log_{2}^{n})       
.        删除                                                      


对于平衡二叉树:
插入/删除 很容易 破坏 “平衡” 特性
需要频繁调整树的形态:
插入导致不平衡 -> 计算平衡因子 -> 找到最小不平衡树 -> 再进行 LL/RR/LR/RL 调整 【时间开销大】


对于红黑树:
插入/删除 不会 破坏 “红黑” 特性
不需要频繁调整树的形态:
即便需要调整，都可以在常数级时间内完成

* 红黑树大概会怎么考？
 * (选择题) - 红黑树的性质，定义
 * 红黑树的插入 - 能手绘插入过程(不太可考代码，略复杂), 删除操作,比较麻烦,可能不考

* 红黑树是二叉树的优化(红黑树是二叉排序树)(左子树的值 < 根节点的值 < 右子树的值)

    * 与普通的二叉树(BST)相比,平衡二叉树(AVL) |左子树 - 右子树| <=1

    * 与普通的二叉树(BST)相比,红黑树(RBT)(红黑树的定义):

        a. 每个节点， 要么是红色，要么是黑色
        b. 根节点是黑色的
        c. 叶子节点(NULL, 失败节点)一定是黑色的
           (红黑树里的叶子节点指的并不是最下面的节点,而是查找失败的节点)
        d. 不存在两个相邻的红色节点
           (红节点的父节点，子节点都是黑色的,不能出现连续的两个红色节点)
           (兄弟节点都是红色可以，父子不可都是红色)
        e. 每个节点,从该节点到任一叶节点的简单路径上所 ”含黑节点“ 的数目相同
           (从任一节点出发到任何一个叶子节点（NULL）所经过的黑色节点的个数都是相同的)

             `左根右, 根叶黑,不红红, 黑路同`

* `黑高` bh: 从任一节点出发，到达叶子节点 （NULL） 所经过的黑色节点的总数(不包括起始的节点)

* 红黑树的性质
        a. 从根节点，到达叶子节点 （NULL） 的最长路径,不大于最短路径的2 倍
            (原因: 1. 从根节点，到达叶子节点 （NULL） 所经过的黑节点数量相同)
            (      2. 不存在两个相邻的红节点)
        b. n 个 内部节点的红黑树高度 h <= 2log_{2}^{(n+1)}, O(log_{2}^{n})

* 红黑树的基本操作
     * 查找
         * 红黑树本质是二叉排序树，与二叉排序树的查找相同，从根节点出发，
                如果要查找的元素大于根节点 往 右走
                如果要查找的元素小于根节点 往 左走
                直到找到元素或到达叶子节点(NULL)查找失败
     * 插入
         (从一棵空树开始) 20 10 5 30 40 57 3 2 4 35 25 18 22 23 24 19 18

             `左根右, 根叶黑,不红红, 黑路同`

             插入 -> 破坏红黑树规则 -> 调整红黑树的姿态 -> 使其符合红黑树规则

         a. 先查找，确定插入的位置(原理同二叉排序树), 插入新节点
         b. 新节点 是"根"，染为 “黑色”
         c. 新节点 非"根"，染为 “红色”
            * 如果插入节点没有违反红黑树的定义，插入结束
            * 如果插入节点破坏了红黑树的定义，需要调整
            (如何调整？看新节点叔叔的脸色行事)

                * 新节点叔叔 是 黑色 --> 旋转 + 染色
                    * LL: 右单旋  , 父换爷 + 染色
                    * RR: 左单旋  , 父换爷 + 染色
                    * LR: 左右双旋, 儿换爷 + 染色
                    * RL: 右左双旋, 儿换爷 + 染色

                * 新节点叔叔 是 红色 --> 染色 + 变新
                    * 叔父爷染色，爷变为新节点

```txt
                                                                                                                    
20                                                                                                                  
                                       20(根:黑)                                                                    
                                      /  \                                                                          
                                (黑) NULL  NULL (黑)                                                                
                                                                                                                    
20 10                                                                                                               
                                       20(根:黑)                                                                    
                                      /  \                                                                          
                                (红) 10   NULL(黑)                                                                  
                                    /  \                                                                            
                              (黑)NULL  NULL (黑)                                                                   
                                                                                                                    

20 10 5                                                                                                             
                                       20(根:黑)                          _ 10(红)_                                 
                                      /  \                               /         \                                
                                (红) 10   NULL(黑)  LL 型          (红) 5           20(黑)                          
                                    /  \           ------->            / \         /      \                         
                             红)   5   NULL(黑)     右单旋     (黑) NULL  NULL(黑) NULL(黑) NULL(黑)                
                                  / \               父换爷                                                          
                           (黑)NULL  NULL(黑)                                                                       
                                                                                                                    
                             [违反了 "不红红"  ]                                                                        
                             [叔叔是黑色的 NULL]                                                                        
                                                                                                                    
                                                                                                                    
                                                                           _ 10(黑)_                                
                                                                          /         \                               
                                                                    (红) 5           20(红)                         
                                                    ------->            / \         /      \                        
                                                     + 染色     (黑) NULL  NULL(黑) NULL(黑) NULL(黑)               
                                                                                                                    

20 10 5 30                                                                                                          
                                                                                                                    
             _ 10(黑)_                                                      _ 10(红)_                               
            /         \                          叔父爷染色                /         \                              
      (红) 5           20(红)                     ------->           (黑) 5           20(黑)                        
          / \         /       \                                          / \         /       \                      
  (黑) NULL  NULL(黑) NULL(黑) 30(红)                            (黑) NULL  NULL(黑) NULL(黑) 30(红)                
                              /  \                                                           /  \                   
                       (黑)NULL  NULL(黑)                                             (黑)NULL  NULL(黑)            
                                                                                                                    
        [违反了"不红红"]                                                                                            
        [叔叔是红色的 5]                                                                                            
        [叔父爷染色，爷变为新节点]        原本的爷视为新增节点               _ 10(黑)_                              
                                               ------->                     /         \                             
                                                                      (黑) 5           20(黑)                       
                                                                          / \         /       \                     
                                                                  (黑) NULL  NULL(黑) NULL(黑) 30(红)               
                                                                                              /  \                  
                                                                                       (黑)NULL  NULL(黑)           
                                                                                                                    
20 10 5 30  40                                                                                                      
                                                                                                                    
             _ 10(黑)_                                                 ___ 10(黑)___                                
            /         \                          RR型                 /             \                               
      (红) 5           20(红)                   ------->        (红) 5              30(红)____                      
          / \         /       \                  左单旋             / \           /           \                     
  (黑) NULL  NULL(黑) NULL(黑) 30(红)            父换爷     (黑) NULL  NULL(黑) 20(黑)        40(红)                
                              /  \                                             /  \            /    \               
                       (黑)NULL  40(红)                                 (黑)NULL  NULL(黑) (黑)NULL  NULL(黑)       
                                /   \                                                                               
                          (黑)NULL  NULL(黑)                                                                        
                                                                                                                    
                                                                                                                    
                                                 ------->              ___ 10(黑)___                                
        [违反了"不红红"]                          +染色               /             \                               
        [叔叔是黑色的NULL]                                      (红) 5             _30(黑)____                      
                                                                    / \           /           \                     
                                                            (黑) NULL  NULL(黑) 20(红)        40(红)                
                                                                               /  \            /    \               
                                                                        (黑)NULL  NULL(黑) (黑)NULL  NULL(黑)       
                                                                                                                    
```

* 总结:
    1. 相关概念
        a.黑高
        b.叶子节点（NULL）

    2. 定义
        a.左根右
        b.根叶黑
        c.不红红
        d.黑路同
    3. 性质
        a.从根节点到叶子节点的最长路径不大于最短路径的 2 倍
        b.有 n 个 内部节点的红黑树 h <=2 * log(n+1)

    4. 插入
        a. 新节点为根,要染黑
        b. 新节点非根,要染红
                      染红后:->违反不红红
                             ->看叔叔脸色
                                 黑叔叔: 旋转+染色
                                            LL: 右单旋 父换爷+染色
                                            RR: 左单旋 父换爷+染色
                                            LR: 左右双旋 儿换爷+染色
                                            RL: 右左双旋 儿换爷+染色
                                 红叔叔: 染色+变新

`黑高`  的推论

黑高为 `h` 的红黑树 内部节点 数至少有多少个？

 * 内部节点 最少的情况: 总共有 h 层黑节点满树的状态
    若根节点 黑高为 h, 内部节点最少有 2^{h} -1 个


